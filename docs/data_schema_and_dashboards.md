# Схема данных

## Сырые таблицы (schema `main`)

### users

| Поле | Тип | Ключ | Описание |
|------|-----|------|----------|
| user_id | int | PK | Идентификатор пользователя |
| email | string | | Email |
| name | string | | Имя |
| country | string | | Страна |
| created_at | timestamp | | Дата регистрации |
| is_active | boolean | | Активен ли пользователь |

### products

| Поле | Тип | Ключ | Описание |
|------|-----|------|----------|
| product_id | int | PK | Идентификатор товара |
| name | string | | Название |
| category | string | | Категория |
| price | decimal | | Цена |

### promotions

| Поле | Тип | Ключ | Описание |
|------|-----|------|----------|
| promo_id | int | PK | Идентификатор промо |
| code | string | | Промокод |
| discount_pct | decimal | | Процент скидки |
| valid_from | date | | Начало действия |
| valid_to | date | | Конец действия |

### orders

| Поле | Тип | Ключ | Описание |
|------|-----|------|----------|
| order_id | int | PK | Идентификатор заказа |
| user_id | int | FK → users | Кто сделал заказ |
| product_id | int | FK → products | Какой товар |
| promo_id | int | FK → promotions | Промокод (опционально) |
| quantity | int | | Количество |
| amount | decimal | | Сумма |
| order_date | date | | Дата заказа |
| status | string | | Статус (completed/pending/cancelled) |

### refunds

| Поле | Тип | Ключ | Описание |
|------|-----|------|----------|
| refund_id | int | PK | Идентификатор возврата |
| order_id | int | FK → orders | К какому заказу |
| amount | decimal | | Сумма возврата |
| refund_date | date | | Дата возврата |
| reason | string | | Причина |

### events

| Поле | Тип | Ключ | Описание |
|------|-----|------|----------|
| event_id | int | PK | Идентификатор события |
| user_id | int | FK → users | Пользователь |
| event_type | string | | Тип события |
| event_at | timestamp | | Время события |
| page | string | | Страница |

### Связи между таблицами

```
users ─────┬─────────────────────────────► orders ◄──────── products
           │                                 │
           │                                 │
           ▼                                 ▼
        events                            refunds
                                             
                orders ◄──────── promotions
```

| Связь | Описание |
|-------|----------|
| orders → users | Кто сделал заказ |
| orders → products | Какой товар заказан |
| orders → promotions | Применённый промокод (опционально) |
| refunds → orders | К какому заказу относится возврат |
| events → users | Какой пользователь совершил действие |

---

## Витрины dbt (после трансформаций)

| Витрина | Назначение | Ключевые поля |
|---------|------------|---------------|
| **fct_orders** | Заказы с пользователем, товаром и промо | order_id, user_id, product_id, amount, amount_after_promo, order_date, order_year, status, user_country, product_category, promo_code |
| **fct_events** | События с пользователем | event_id, user_id, event_type, event_at, event_year, event_month, page, user_country |
| **dim_products** | Справочник товаров | product_id, name, category, price, has_price |
| **stg_refunds** | Возвраты (staging) | refund_id, order_id, amount, refund_date, reason |

---

# Запросы на дашборды (тикеты от бизнеса)

## TICKET-001: Анализ продаж и выручки

**От:** Коммерческий директор

**Описание:**

Привет! Мне нужен дашборд, чтобы отслеживать как у нас идут продажи. Хочу видеть общую выручку и как она меняется по месяцам — растём мы или падаем. Также важно понимать, сколько заказов мы делаем и сколько у нас уникальных клиентов.

Было бы здорово видеть разбивку по странам — где мы больше всего продаём. И ещё интересует средний чек — это поможет понять, не мельчают ли у нас заказы.

**Вопросы, на которые хочу получить ответы:**
- Какая у нас общая выручка за период?
- Как выручка менялась по месяцам/годам?
- Сколько заказов и уникальных клиентов?
- Какой средний чек?
- Какие страны приносят больше всего выручки?
- Как распределяются заказы по статусам (завершённые, отменённые)?

---

## TICKET-002: Эффективность промо-акций

**От:** Руководитель маркетинга

**Описание:**

Нам нужно понять, насколько эффективны наши промо-акции. Мы раздаём много промокодов, но не понимаем, какие из них реально работают, а какие просто съедают маржу.

Хочу видеть, сколько выручки приходит по промокодам и сколько — без скидок. Интересует также, какой средний чек у заказов со скидкой и без — может оказаться, что скидки привлекают только мелкие заказы.

**Вопросы, на которые хочу получить ответы:**
- Какая доля заказов идёт с промокодами?
- Какие промокоды используются чаще всего?
- Как выручка со скидками соотносится с выручкой без скидок?
- Какой средний чек с промо vs без промо?
- Какой средний размер скидки?

---

## TICKET-003: Продуктовая аналитика

**От:** Категорийный менеджер

**Описание:**

Хочу понять, какие категории товаров у нас продаются лучше всего, а какие отстают. Нужна разбивка выручки по категориям и желательно — по конкретным товарам.

Ещё интересно посмотреть динамику: может быть, какая-то категория раньше была популярной, а сейчас падает. Это поможет принимать решения по ассортименту.

**Вопросы, на которые хочу получить ответы:**
- Какие категории товаров приносят больше всего выручки?
- Какие конкретные товары — топ продаж?
- Сколько единиц товара мы продаём по категориям?
- Как меняются продажи по категориям во времени?
- Какая средняя цена товаров в разных категориях?

---

## TICKET-004: География продаж и клиенты

**От:** Директор по развитию

**Описание:**

Мы планируем расширение на новые рынки и хотим понять, как распределяются наши текущие продажи по географии. Нужно видеть, какие страны для нас ключевые, а где мы почти не представлены.

Также важно понимать не только выручку, но и количество клиентов в каждой стране — может оказаться, что где-то у нас много мелких клиентов, а где-то мало, но крупных.

**Вопросы, на которые хочу получить ответы:**
- Какие страны приносят больше всего выручки?
- Сколько уникальных клиентов в каждой стране?
- Какая доля выручки приходится на топ-5 стран?
- Какой средний чек по странам?
- Какие категории товаров популярны в разных странах?

---

## TICKET-005: Анализ возвратов

**От:** Директор по качеству

**Описание:**

У нас есть проблема с возвратами, и я хочу понять её масштаб. Нужно видеть, сколько денег мы теряем на возвратах и какие причины возвратов самые частые.

Если получится — хорошо бы понять, есть ли связь между категориями товаров и возвратами. Может быть, какие-то товары возвращают чаще.

**Вопросы, на которые хочу получить ответы:**
- Какой общий объём возвратов в деньгах?
- Какой процент от выручки составляют возвраты?
- Какие причины возвратов самые частые?
- Как возвраты распределяются по месяцам — растут или падают?
- Есть ли категории товаров с повышенным уровнем возвратов?

---

## TICKET-006: Поведение пользователей на сайте

**От:** Продуктовый менеджер

**Описание:**

Хочу понять, как пользователи ведут себя на нашем сайте. Какие страницы они посещают, какие действия совершают. Это поможет понять, где у нас узкие места в воронке.

Интересует также география — может быть, пользователи из разных стран ведут себя по-разному.

**Вопросы, на которые хочу получить ответы:**
- Сколько событий (просмотров, кликов) происходит на сайте?
- Какие типы событий самые частые?
- Какие страницы самые популярные?
- Сколько уникальных пользователей активны на сайте?
- Как активность меняется по месяцам?
- Есть ли разница в поведении пользователей из разных стран?

---

## TICKET-007: Сводный операционный дашборд для руководства

**От:** Генеральный директор

**Описание:**

Мне нужен один экран, где я смогу за 30 секунд понять, как идут дела в компании. Не хочу копаться в деталях — нужны ключевые цифры: выручка, заказы, клиенты, возвраты.

Желательно видеть динамику — растём или падаем. И основные разрезы: по странам, по статусам заказов. Если что-то идёт не так — я должен сразу это заметить.

**Вопросы, на которые хочу получить ответы:**
- Какая общая выручка? Растёт или падает?
- Сколько заказов и клиентов?
- Какой объём возвратов и процент от выручки?
- Как распределяется выручка по странам?
- Какая доля заказов завершена, а какая отменена?
- Какие категории товаров в топе?
